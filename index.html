<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZikLabs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #171725;
            color: #E2E8F0;
        }
        .card {
            background-color: #212134;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            border: 1px solid #33334e;
        }
        .gradient-button {
            background-image: linear-gradient(to right, #6D28D9, #4C1D95);
        }
        .gradient-border-btn {
            background-color: transparent;
            border: 1px solid #6D28D9;
        }
        .gradient-text {
            background: -webkit-linear-gradient(right, #6D28D9, #4C1D95);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .icon {
            filter: invert(1);
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <!-- Main Container Card -->
    <div id="main-card" class="card w-full max-w-sm mx-auto p-6 md:p-8 space-y-6 transition-all duration-300 ease-in-out">

        <!-- Header -->
        <div class="flex items-center space-x-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
            <h1 class="text-2xl font-bold text-white">ZikLabs</h1>
        </div>

        <!-- Image Upload Section -->
        <div class="card p-4 space-y-4">
            <div class="flex items-center justify-center space-x-2 text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18ZM1.5 12C1.5 6.201 6.201 1.5 12 1.5S22.5 6.201 22.5 12 17.799 22.5 12 22.5 1.5 17.799 1.5 12Z"/></svg>
                <span class="font-bold text-white">Add Equipment Image</span>
            </div>
            <p class="text-xs text-center text-gray-400">Clear, well-lit photos ensure accurate analysis</p>

            <div class="flex flex-col items-center space-y-2">
                <button id="camera-button" class="w-full py-3 text-white font-semibold rounded-lg gradient-button shadow-md hover:opacity-90 transition-opacity duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h5l2-2h6l2 2h5v15c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2zm8 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/><circle cx="12" cy="14" r="3"/></svg>
                    Take photo
                </button>
                <button id="upload-button" class="w-full py-3 text-white font-semibold rounded-lg gradient-border-btn shadow-md hover:bg-opacity-10 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M19 12h-4v-4h-2v4h-4v2h4v4h2v-4h4v-2zM5 19h14V5H5v14zM19 3c1.1 0 2 .9 2 2v14c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h14z"/></svg>
                    Upload from Gallery
                </button>
                <input type="file" id="file-input" class="hidden" accept="image/*">
            </div>
            <div id="image-preview-container" class="hidden flex justify-center items-center">
                <img id="preview-image" src="" alt="Image Preview" class="w-full rounded-md max-w-xs">
            </div>
        </div>

        <!-- Optional Text Prompt -->
        <div class="space-y-2">
            <h2 class="text-sm font-semibold text-gray-200">Describe the Experiment (optional but recommended!)</h2>
            <textarea id="prompt-input" rows="3" class="w-full p-2 rounded-lg bg-transparent border border-gray-600 focus:ring-2 focus:ring-purple-600 focus:border-purple-600 resize-none text-gray-300 placeholder-gray-500" placeholder="E.g. Determining Diode Characteristics and Transistor Biasing..."></textarea>
        </div>

        <!-- Pro Tip Card -->
        <div class="card p-3 flex items-start space-x-2">
            <span class="text-purple-400">ðŸ’¡</span>
            <p class="text-sm text-gray-400">
                <span class="font-bold text-gray-200">Pro tip:</span> Clear photos and context ensure more accurate results. Unclear images or vague experiment may affect feedback.
            </p>
        </div>

        <!-- Analyze Button -->
        <button id="analyze-button" class="w-full py-3 text-white text-lg font-bold rounded-lg gradient-button shadow-md hover:opacity-90 transition-opacity duration-200" disabled>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16a6.471 6.471 0 0 0 3.75-1.07l.27.28v.79l5 4.99L20.49 19l-4.99-5zM9.5 14C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            Analyze
        </button>
        
        <!-- Contact Us -->
        <div class="flex justify-center items-center pt-2">
            <a href="#" class="flex items-center text-sm text-gray-400 hover:text-purple-400 transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>
                Contact us
            </a>
        </div>

        <!-- Status Message Box -->
        <div id="message-box" class="hidden p-4 rounded-lg text-sm transition-all duration-300 text-center"></div>

    </div>

    <!-- Analysis Results Card (Initially hidden) -->
    <div id="results-card" class="card w-full max-w-sm mx-auto p-6 md:p-8 space-y-6 mt-6 hidden transition-all duration-300 ease-in-out">
        <button id="back-button" class="flex items-center text-gray-400 hover:text-purple-400 transition-colors duration-200 mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
            Back
        </button>
        
        <div class="flex items-center space-x-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-400" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h-2v6z"/></svg>
            <h2 class="text-2xl font-bold text-white">Analysis Results</h2>
        </div>
        
        <!-- Image Preview for Results -->
        <div class="card p-2 flex justify-center items-center">
            <img id="results-image-preview" src="" alt="Analysis Image" class="w-full rounded-md max-w-xs">
        </div>

        <!-- Detected Issues Card (New from A3.png) -->
        <div id="detected-issues-card" class="card p-4 space-y-2 hidden">
            <div class="flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2c-5.52 0-10 4.48-10 10s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v-2h-2v2zm0-4h2V7h-2v6z"/></svg>
                <h3 class="font-bold text-red-400">Detected Issues (<span id="detected-issues-count">0</span>)</h3>
            </div>
            <ul id="detected-issues-list" class="list-none text-red-300 space-y-2"></ul>
        </div>
        
        <!-- Equipment Info Card (Updated from Newting9.png) -->
        <div class="card p-4 space-y-2">
            <div class="flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor" style="background: linear-gradient(to right, #6D28D9, #4C1D95); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"><path d="M12 2L4 5v6.09c0 4.54 3.2 8.79 7.5 9.88V22h1v-1.03c4.3-.96 7.5-5.33 7.5-9.88V5L12 2z"/></svg>
                <h3 class="font-bold text-white">Equipment Information</h3>
            </div>
            <p><span class="font-semibold text-gray-400">Name:</span> <span id="equipment-name" class="text-gray-300"></span></p>
            <p><span class="font-semibold text-gray-400">Summary:</span> <span id="equipment-summary" class="text-gray-300"></span></p>
        </div>

        <!-- Safety Warnings and Precautions (New from A3.png) -->
        <div id="safety-card" class="card p-4 space-y-2 hidden">
            <div class="flex items-center space-x-2">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor" style="background: linear-gradient(to right, #6D28D9, #4C1D95); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"><path d="M12 2L4 5v6.09c0 4.54 3.2 8.79 7.5 9.88V22h1v-1.03c4.3-.96 7.5-5.33 7.5-9.88V5L12 2z"/></svg>
                <h3 class="font-bold text-white">Safety Warnings and Precautions</h3>
            </div>
            <ul id="safety-warnings-list" class="list-none text-gray-300 space-y-2"></ul>
        </div>

        <!-- How to Use Card (Updated from Newting9.png) -->
        <div class="card p-4 space-y-2">
            <div class="flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor" style="background: linear-gradient(to right, #6D28D9, #4C1D95); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"><path d="M12 2L4 5v6.09c0 4.54 3.2 8.79 7.5 9.88V22h1v-1.03c4.3-.96 7.5-5.33 7.5-9.88V5L12 2z"/></svg>
                <h3 class="font-bold text-white">How to Properly Use</h3>
            </div>
            <ul id="how-to-use-list" class="list-decimal list-inside text-gray-300 space-y-1"></ul>
        </div>
        
        <!-- Associated Equipment Card (Updated from Newting10.png) -->
        <div class="card p-4 space-y-2">
            <div class="flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor" style="background: linear-gradient(to right, #6D28D9, #4C1D95); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"><path d="M12 2L4 5v6.09c0 4.54 3.2 8.79 7.5 9.88V22h1v-1.03c4.3-.96 7.5-5.33 7.5-9.88V5L12 2z"/></svg>
                <h3 class="font-bold text-white">Commonly Associated Equipment</h3>
            </div>
            <div id="associated-equipment-list" class="grid grid-cols-2 gap-4 mt-2"></div>
        </div>
        
        <!-- Coming Features -->
        <div class="space-y-4 pt-4 border-t border-gray-700">
            <h2 class="text-xl font-bold text-white">Coming Features</h2>
            <div class="grid grid-cols-1 gap-4">
                <button id="summarize-button" class="w-full py-3 text-white font-bold rounded-lg gradient-button shadow-md hover:opacity-90 transition-colors duration-200" disabled>
                    <span class="gradient-text font-bold">âœ¨</span> Summarize Analysis
                </button>
                <button id="quiz-button" class="w-full py-3 text-white font-bold rounded-lg gradient-button shadow-md hover:opacity-90 transition-colors duration-200" disabled>
                    <span class="gradient-text font-bold">âœ¨</span> Generate Study Quiz
                </button>
            </div>
            
            <div id="additional-results" class="hidden space-y-4">
                <!-- Summary Result -->
                <div id="summary-card" class="card p-4 hidden">
                    <h3 class="font-bold text-gray-200 mb-2">Summary</h3>
                    <p id="summary-text" class="text-gray-300"></p>
                </div>

                <!-- Quiz Result -->
                <div id="quiz-card" class="card p-4 hidden">
                    <h3 class="font-bold text-bold text-gray-200 mb-2">Study Quiz</h3>
                    <div id="quiz-questions" class="space-y-6"></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const API_KEY = "AIzaSyD4CON7omCIemrsI-TzAujg1QUkvmDcLZ0";
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=" + API_KEY;

        const mainCard = document.getElementById('main-card');
        const resultsCard = document.getElementById('results-card');
        const cameraButton = document.getElementById('camera-button');
        const uploadButton = document.getElementById('upload-button');
        const fileInput = document.getElementById('file-input');
        const previewImage = document.getElementById('preview-image');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const analyzeButton = document.getElementById('analyze-button');
        const messageBox = document.getElementById('message-box');
        const resultsImagePreview = document.getElementById('results-image-preview');
        const detectedIssuesCard = document.getElementById('detected-issues-card');
        const detectedIssuesCount = document.getElementById('detected-issues-count');
        const detectedIssuesList = document.getElementById('detected-issues-list');
        const equipmentName = document.getElementById('equipment-name');
        const equipmentSummary = document.getElementById('equipment-summary');
        const safetyCard = document.getElementById('safety-card');
        const safetyWarningsList = document.getElementById('safety-warnings-list');
        const howToUseList = document.getElementById('how-to-use-list');
        const associatedEquipmentList = document.getElementById('associated-equipment-list');
        const promptInput = document.getElementById('prompt-input');
        const backButton = document.getElementById('back-button');

        let uploadedImageBase64 = '';

        function showMessage(message, type = 'info') {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'bg-red-500', 'bg-blue-500', 'bg-green-500');
            if (type === 'error') {
                messageBox.classList.add('bg-red-500', 'text-white');
            } else if (type === 'success') {
                messageBox.classList.add('bg-green-500', 'text-white');
            } else {
                messageBox.classList.add('bg-blue-500', 'text-white');
            }
            messageBox.style.display = 'block'; // Ensure the message box is visible
        }

        // Smooth page transition handler
        function animatePageTransition(showEl, hideEl, direction = "forward") {
            // direction: "forward" = slide in from right, "backward" = slide in from left
            const outTranslate = direction === "forward" ? "-translate-x-10" : "translate-x-10";
            const inTranslate  = direction === "forward" ? "translate-x-10" : "-translate-x-10";

            // Prepare show element
            showEl.classList.remove("hidden");
            showEl.classList.add("opacity-0", inTranslate);

            // Animate hide element out
            hideEl.classList.add(outTranslate, "opacity-0");
            hideEl.classList.remove("opacity-100");

            setTimeout(() => {
                hideEl.classList.add("hidden");
                hideEl.classList.remove(outTranslate);

                // Animate show element in
                showEl.classList.remove("opacity-0", inTranslate);
                showEl.classList.add("opacity-100");
            }, 300); // matches Tailwind duration
        }

        // This function now animates instead of instantly swapping
        function showResultsPage(data) {
            displayResults(data);
            animatePageTransition(resultsCard, mainCard, "forward");
        }

        // Back button animates in reverse
        backButton.addEventListener('click', () => {
            animatePageTransition(mainCard, resultsCard, "backward");
        });

        cameraButton.addEventListener('click', () => fileInput.click());
        uploadButton.addEventListener('click', () => fileInput.click());
        
        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewImage.src = e.target.result;
                    resultsImagePreview.src = e.target.result;
                    imagePreviewContainer.classList.remove('hidden');
                    analyzeButton.disabled = false;
                    uploadedImageBase64 = e.target.result.split(',')[1];
                };
                reader.readAsDataURL(file);
            }
        });

        analyzeButton.addEventListener('click', async () => {
            if (!uploadedImageBase64) {
                showMessage('Please upload an image first.', 'error');
                return;
            }

            analyzeButton.disabled = true;
            showMessage('Analyzing image...', 'info');

            const userPrompt = promptInput.value.trim();
            const fullPrompt = `You are a lab equipment analyzer. You will receive an image of a piece of lab equipment. Your task is to analyze the image and the user's optional text prompt to provide the following information in a JSON format. The JSON should have the following structure:
                {
                    "equipment_info": {
                        "name": "The name of the lab equipment.",
                        "summary": "A brief summary of the equipment's purpose and function."
                    },
                    "detected_issues": [
                        "A list of issues or potential problems detected in the image (e.g., 'cracked glassware', 'loose wire'). If none, return an empty array."
                    ],
                    "safety_warnings": [
                        "A list of key safety precautions when using this equipment.",
                        "Each item in the list should be a new string."
                    ],
                    "how_to_use": [
                        "Step-by-step instructions on how to use the equipment.",
                        "Each item in the list should be a new string."
                    ],
                    "associated_equipment": [
                        {
                            "name": "Name of associated equipment.",
                            "search_url": "A Google Search URL to find this associated equipment."
                        }
                    ]
                }
                If you cannot identify the equipment or it is not lab equipment, provide a brief, general description instead of specific details, and fill the other fields with appropriate default values.
            `;

            const payload = {
                contents: [
                    {
                        parts: [
                            { text: fullPrompt },
                            {
                                inlineData: {
                                    mimeType: "image/png",
                                    data: uploadedImageBase64
                                }
                            }
                        ]
                    }
                ],
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    const cleanedText = text.replace(/```json|```/g, '').trim();
                    const data = JSON.parse(cleanedText);
                    showResultsPage(data);
                    showMessage('Analysis complete!', 'success');
                } else {
                    throw new Error('No text content received from API.');
                }
            } catch (error) {
                console.error("Analysis failed:", error);
                showMessage("Failed to get analysis. Please try again.", 'error');
            } finally {
                analyzeButton.disabled = false;
            }
        });

        function displayResults(data) {
            // Equipment Info
            const name = data?.equipment_info?.name || "Unidentified Equipment";
            const summary = data?.equipment_info?.summary || "The API could not provide a specific summary for this equipment.";
            equipmentName.textContent = name;
            equipmentSummary.textContent = summary;

            // Detected Issues
            const issues = data?.detected_issues || [];
            if (issues.length > 0) {
                detectedIssuesCard.classList.remove('hidden');
                detectedIssuesCount.textContent = issues.length;
                detectedIssuesList.innerHTML = '';
                issues.forEach(issue => {
                    const li = document.createElement('li');
                    li.textContent = `â€¢ ${issue}`;
                    detectedIssuesList.appendChild(li);
                });
            } else {
                detectedIssuesCard.classList.add('hidden');
            }

            // Safety Warnings
            const safetyWarnings = data?.safety_warnings || [];
            if (safetyWarnings.length > 0) {
                safetyCard.classList.remove('hidden');
                safetyWarningsList.innerHTML = '';
                safetyWarnings.forEach(warning => {
                    const li = document.createElement('li');
                    li.textContent = `â€¢ ${warning}`;
                    safetyWarningsList.appendChild(li);
                });
            } else {
                safetyCard.classList.add('hidden');
            }

            // How to Use
            const howToUse = data?.how_to_use || [];
            if (howToUse.length > 0) {
                howToUseList.innerHTML = '';
                howToUse.forEach(step => {
                    const li = document.createElement('li');
                    li.textContent = step;
                    howToUseList.appendChild(li);
                });
            }

            // Associated Equipment
            const associatedEquipment = data?.associated_equipment || [];
            associatedEquipmentList.innerHTML = '';
            associatedEquipment.forEach(item => {
                const div = document.createElement('div');
                div.className = "flex flex-col items-center space-y-2";
                
                const img = document.createElement('img');
                img.src = `https://placehold.co/100x100?text=${encodeURIComponent(item.name.split(' ')[0])}`;
                img.className = "rounded-md";
                div.appendChild(img);

                const link = document.createElement('a');
                link.href = item.search_url;
                link.textContent = item.name;
                link.target = "_blank";
                link.className = "text-sm text-gray-400 hover:text-purple-400 font-medium text-center";
                div.appendChild(link);
                associatedEquipmentList.appendChild(div);
            });
        }
    </script>
</body>
</html>
